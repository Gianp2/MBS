<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="MBS Barber Studio - Experiencia VIP en cortes de cabello, barba y color en Las Parejas, Santa Fe. Reserva tu turno hoy.">
  <meta name="keywords" content="barbería, cortes de cabello, barba, color, Las Parejas, Santa Fe, MBS Barber Studio">
  <meta name="author" content="MBS Barber Studio">
  <meta property="og:title" content="MBS Barber Studio - Las Parejas, Santa Fe">
  <meta property="og:description" content="Experimenta un servicio VIP con cortes de cabello, barba y color de primer nivel.">
  <meta property="og:image" content="img/logomonkey.png">
  <meta property="og:url" content="https://www.mbsbarberstudio.com">
  <title>MBS Barber Studio</title>
  <link rel="icon" href="img/logomonkey.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <style>
    section {
      scroll-margin-top: 80px;
    }
    .gallery-item img {
      max-block-size: 320px;
      object-fit: cover;
      inline-size: 100%;
    }
    .nav-link {
      position: relative;
      transition: all 0.3s ease;
    }
    .nav-link:hover {
      color: #facc15;
      transform: scale(1.05);
    }
    .nav-link::after {
      content: '';
      position: absolute;
      inline-size: 0;
      block-size: 2px;
      inset-block-end: -2px;
      inset-inline-start: 0;
      background-color: #facc15;
      transition: width 0.3s ease;
    }
    .nav-link:hover::after {
      inline-size: 100%;
    }
    .nav-link.admin {
      background-color: #facc15;
      color: #1f2937;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    .nav-link.admin:hover {
      background-color: #eab308;
      color: #1f2937;
      transform: scale(1.05);
    }
    .nav-link.admin::after {
      display: none;
    }
    #mobile-menu {
      position: fixed;
      inset-block-start: 0;
      inset-inline-end: 0;
      block-size: 100vh;
      inline-size: 75%;
      max-inline-size: 300px;
      background-color: rgba(31, 41, 55, 0.95);
      transition: transform 0.3s ease-in-out;
      transform: translateX(100%);
      box-shadow: -4px 0 10px rgba(0, 0, 0, 0.3);
      z-index: 50;
    }
    #mobile-menu.active {
      transform: translateX(0);
    }
    #mobile-menu a {
      display: block;
      padding: 0.75rem 1rem;
      font-size: 1.1rem;
      font-weight: 500;
      text-align: center;
      color: #e5e7eb;
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    #mobile-menu a:hover {
      background-color: #4b5563;
      color: #facc15;
    }
    #mobile-menu a.nav-link.admin {
      margin: 0.5rem 1rem;
      border-radius: 8px;
    }
    .floating-reserve-button {
      position: fixed;
      inset-block-end: 20px;
      inset-inline-end: 20px;
      z-index: 100;
      background-color: #facc15;
      color: #1f2937;
      padding: 12px 20px;
      border-radius: 50px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      transition: transform 0.3s ease, background-color 0.3s ease;
    }
    .floating-reserve-button:hover {
      background-color: #eab308;
      transform: scale(1.05);
    }
    .floating-reserve-button img {
      inline-size: 24px;
      block-size: 24px;
    }
    .form-turno input, .form-turno select {
      @apply w-full p-3 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-sm;
    }
    .form-turno option:disabled {
      color: #6b7280;
      background-color: #374151;
    }
    .form-turno label {
      @apply flex items-center gap-2;
    }
    .form-turno i {
      color: #facc15;
    }
    input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(70%) sepia(50%) saturate(300%) hue-rotate(30deg) brightness(100%);
    }
    @media (max-width: 640px) {
      .form-turno {
        @apply max-w-xs p-6;
      }
      input, select {
        @apply text-sm p-3;
      }
      button[type="submit"] {
        @apply text-base py-2;
      }
    }
    #admin-modal {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.75);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    #admin-modal.active {
      display: flex;
    }
    #admin-modal .modal-content {
      background-color: #1f2937;
      padding: 1.5rem;
      border-radius: 12px;
      max-width: 900px;
      width: 95%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }
    #admin-modal .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    #admin-modal .action-bar button {
      background-color: #facc15;
      color: #1f2937;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #admin-modal .action-bar button:hover {
      background-color: #eab308;
      transform: scale(1.05);
    }
    #admin-modal table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      color: #e5e7eb;
      font-family: 'Open Sans', sans-serif;
    }
    #admin-modal th, #admin-modal td {
      padding: 0.75rem;
      text-align: left;
      font-size: 0.9rem;
      border-bottom: 1px solid #4b5563;
    }
    #admin-modal th {
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      background-color: #374151;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    #admin-modal tbody tr:nth-child(even) {
      background-color: #2d3748;
    }
    #admin-modal tbody tr:hover {
      background-color: #4b5563;
      transition: background-color 0.2s ease;
    }
    #admin-modal .toggle-disponible {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #admin-modal .toggle-disponible.disponible {
      background-color: #10b981;
      color: white;
    }
    #admin-modal .toggle-disponible.no-disponible {
      background-color: #e3342f;
      color: white;
    }
    #admin-modal .toggle-disponible:hover {
      transform: scale(1.05);
    }
    #admin-modal .toggle-disponible.disponible:hover {
      background-color: #059669;
    }
    #admin-modal .toggle-disponible.no-disponible:hover {
      background-color: #c53030;
    }
    #admin-modal .edit-turno {
      background-color: #3b82f6;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      margin-left: 0.5rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #admin-modal .edit-turno:hover {
      background-color: #2563eb;
      transform: scale(1.05);
    }
    #admin-modal .delete-turno {
      background-color: #dc2626;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      margin-left: 0.5rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #admin-modal .delete-turno:hover {
      background-color: #b91c1c;
      transform: scale(1.05);
    }
    #admin-modal .editable-name {
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #admin-modal .editable-name:hover {
      background-color: #4b5563;
    }
    #admin-modal .close-modal {
      background-color: #e3342f;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      transition: background-color 0.3s ease, transform 0.2s ease;
      margin-top: 1rem;
    }
    #admin-modal .close-modal:hover {
      background-color: #c53030;
      transform: scale(1.05);
    }
    @media (max-width: 640px) {
      #admin-modal table {
        display: none;
      }
      #admin-modal .turnos-mobile {
        display: block;
      }
      #admin-modal .turno-card {
        background-color: #2d3748;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      #admin-modal .turno-card:nth-child(even) {
        background-color: #374151;
      }
      #admin-modal .turno-card:hover {
        background-color: #4b5563;
        transition: background-color 0.2s ease;
      }
      #admin-modal .turno-card p {
        margin: 0.5rem 0;
        font-size: 0.9rem;
        color: #e5e7eb;
      }
      #admin-modal .turno-card .turno-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
      }
      #admin-modal .turno-card .turno-actions button {
        flex: 1;
        min-width: 100px;
        padding: 0.5rem;
        font-size: 0.85rem;
      }
    }
    @media (min-width: 641px) {
      #admin-modal .turnos-mobile {
        display: none;
      }
    }
  </style>
</head>

<body class="font-['Open Sans'] bg-gradient-to-b from-gray-900 to-gray-800 text-gray-200">
  <header class="bg-gray-900 text-gray-200 sticky top-0 z-50 shadow-lg">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <img src="img/logomonkey.png" alt="MBS Barber Studio Logo" class="h-14 w-auto">
        <h1 class="logo-text text-2xl md:text-3xl font-extrabold tracking-wide font-['Poppins']">
          MBS <span class="text-yellow-400 drop-shadow-glow">Barber</span> Studio
        </h1>
      </div>
      <nav class="hidden md:flex space-x-8" aria-label="Navegación principal">
        <a href="#inicio" class="nav-link font-medium font-['Poppins']">Inicio</a>
        <a href="#servicios" class="nav-link font-medium font-['Poppins']">Servicios</a>
        <a href="#turnos" class="nav-link font-medium font-['Poppins']">Reserva</a>
        <a href="#pagos" class="nav-link font-medium font-['Poppins']">Pagos</a>
        <a href="#contacto" class="nav-link font-medium font-['Poppins']">Contacto</a>
        <a href="javascript:void(0)" id="admin-link" class="nav-link admin font-medium font-['Poppins']"><i class="fas fa-user-shield mr-2"></i>Admin</a>
      </nav>
      <button class="md:hidden menu-toggle" aria-label="Abrir menú móvil">
        <i class="fas fa-bars text-2xl"></i>
      </button>
    </div>
    
    <nav class="hidden md:hidden flex-col" id="mobile-menu" aria-label="Menú móvil">
      <a href="#inicio" class="nav-link font-['Poppins']">Inicio</a>
      <a href="#servicios" class="nav-link font-['Poppins']">Servicios</a>
      <a href="#turnos" class="nav-link font-['Poppins']">Reserva</a>
      <a href="#pagos" class="nav-link font-['Poppins']">Pagos</a>
      <a href="#contacto" class="nav-link font-['Poppins']">Contacto</a>
      <a href="javascript:void(0)" id="admin-link-mobile" class="nav-link admin font-['Poppins']"><i class="fas fa-user-shield mr-2"></i>Admin</a>
    </nav>
  </header>

  <main>
    <section id="inicio" class="relative h-[700px] flex items-center justify-center text-center text-gray-200">
      <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('img/fotohero.jpg');"></div>
      <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/50 to-black/70"></div>
      <div class="relative z-10 px-6 md:px-12 max-w-4xl">
        <h2 class="text-4xl md:text-6xl font-bold mb-6 font-['Poppins'] leading-tight drop-shadow-lg">
          Bienvenidos a <span class="text-yellow-400">MBS Barber Studio</span>
        </h2>
        <p class="text-lg md:text-2xl mb-8 leading-relaxed drop-shadow-md">
          Experimenta un servicio VIP con cortes de cabello, barba y color de primer nivel en 
          <span class="font-semibold">Las Parejas, Santa Fe</span>.
        </p>
        <a href="#turnos" class="inline-block bg-yellow-400 text-gray-900 font-semibold py-4 px-10 rounded-full shadow-lg hover:bg-yellow-500 hover:shadow-xl transition-all duration-300 text-lg font-['Poppins']">
          Reservar Turno
        </a>
      </div>
    </section>

    <section id="nosotros" class="py-20 bg-gradient-to-b from-gray-800 to-gray-900">
      <div class="container mx-auto px-4 text-center">
        <h2 class="text-4xl font-bold mb-8 font-['Poppins'] text-gray-200">Sobre Nosotros</h2>
        <p class="text-lg mb-10 max-w-3xl mx-auto leading-relaxed text-gray-300">
          En MBS Barber Studio, combinamos pasión y profesionalismo para ofrecerte una experiencia única en barbería. 
          Nuestro equipo está comprometido con realzar tu estilo personal con cortes de cabello, arreglos de barba y coloración de alta calidad.
        </p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto">
          <div class="relative group">
            <img src="img/fotouli.jpg" alt="Nuestro equipo" class="w-full h-80 object-cover object-top rounded-lg shadow-lg transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 font-['Poppins']">Equipo Profesional</p>
          </div>
          <div class="relative group">
            <img src="img/local2.jpg" alt="Nuestro salón" class="w-full h-80 object-cover object-[center_30%] rounded-lg shadow-lg transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 font-['Poppins']">Ambiente Moderno</p>
          </div>
        </div>
      </div>
    </section>

    <section id="galeria" class="py-20 bg-gradient-to-b from-gray-900 to-gray-800">
      <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold text-center mb-8 font-['Poppins'] text-gray-200">Galería</h2>
        <p class="text-center mb-10 text-lg text-gray-300">Explora nuestros trabajos destacados y síguenos en <a href="https://www.instagram.com/mbsbarberstudio/" target="_blank" rel="noopener" class="text-yellow-400 hover:underline">Instagram</a> para más inspiración.</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
          <div class="gallery-item relative group">
            <img src="img/corte.jpg" alt="Corte y barba" class="w-full h-80 object-cover rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 text-center font-['Poppins']">Corte y Barba</p>
          </div>
          <div class="gallery-item relative group">
            <img src="img/corte2.jpg" alt="Coloración masculina" class="w-full h-80 object-cover rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 text-center font-['Poppins']">Coloración Masculina</p>
          </div>
          <div class="gallery-item relative group">
            <img src="img/corte3.jpg" alt="Corte de cabello hombre" class="w-full h-80 object-cover object-top rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 text-center font-['Poppins']">Corte de Cabello</p>
          </div>
          <div class="gallery-item relative group">
            <img src="img/corte4.jpg" alt="Corte clásico" class="w-full h-80 object-cover rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 text-center font-['Poppins']">Corte Clásico</p>
          </div>
          <div class="gallery-item relative group">
            <img src="img/corte5.jpg" alt="Corte clásico" class="w-full h-80 object-cover rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 text-center font-['Poppins']">Corte Clásico</p>
          </div>
          <div class="gallery-item relative group">
            <img src="img/corte6.jpg" alt="Corte clásico" class="w-full h-80 object-cover rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105" loading="lazy">
            <p class="mt-4 font-semibold text-lg text-gray-200 text-center font-['Poppins']">Corte Clásico</p>
          </div>
        </div>
      </div>
    </section>

    <section id="servicios" class="py-20 bg-gradient-to-b from-gray-800 to-gray-900">
      <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold text-center mb-8 font-['Poppins']">Nuestros Servicios</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          <div class="service-item text-center p-8 bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow">
            <i class="fas fa-scissors text-5xl text-yellow-400 mb-4"></i>
            <h3 class="text-2xl font-semibold mb-3 text-gray-200 font-['Poppins']">Corte Hombre</h3>
            <p class="text-gray-300">Corte personalizado con técnicas modernas.</p>
          </div>
          <div class="service-item text-center p-8 bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow">
            <i class="fas fa-cut text-5xl text-yellow-400 mb-4"></i>
            <h3 class="text-2xl font-semibold mb-3 text-gray-200 font-['Poppins']">Corte + Barba</h3>
            <p class="text-gray-300">Combinación perfecta para un look completo.</p>
          </div>
          <div class="service-item text-center p-8 bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow">
            <i class="fas fa-paint-brush text-5xl text-yellow-400 mb-4"></i>
            <h3 class="text-2xl font-semibold mb-3 text-gray-200 font-['Poppins']">Color</h3>
            <p class="text-gray-300">Coloración profesional para un estilo único.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="turnos" class="py-20 bg-gradient-to-b from-gray-800 to-gray-900">
      <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold text-center mb-8 font-['Poppins'] text-gray-200">Reservar Turno</h2>
        <div id="form-turno" class="max-w-lg mx-auto p-8 bg-gray-800 rounded-lg shadow-md form-turno" aria-label="Formulario de reserva de turno">
          <form id="reserva-form" onsubmit="reservarTurno(event)">
            <div class="mb-6">
              <label for="nombre" class="block text-sm font-medium mb-2 text-gray-200 font-['Poppins']"><i class="fas fa-user"></i> Nombre:</label>
              <input type="text" id="nombre" name="nombre" required aria-required="true" placeholder="Tu nombre completo" class="w-full p-4 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-400">
            </div>
            <div class="mb-6">
              <label for="telefono" class="block text-sm font-medium mb-2 text-gray-200 font-['Poppins']"><i class="fas fa-phone"></i> Teléfono:</label>
              <input type="tel" id="telefono" name="telefono" required aria-required="true" pattern="[0-9]{10,}" title="Ingrese un número de teléfono válido" placeholder="Ej: 3471511010" class="w-full p-4 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-400">
            </div>
            <div class="mb-6">
              <label for="fecha" class="block text-sm font-medium mb-2 text-gray-200 font-['Poppins']"><i class="fas fa-calendar-alt"></i> Fecha:</label>
              <input type="date" id="fecha" name="fecha" required aria-required="true" class="w-full p-4 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-400">
            </div>
            <div class="mb-6">
              <label for="hora" class="block text-sm font-medium mb-2 text-gray-200 font-['Poppins']"><i class="fas fa-clock"></i> Hora:</label>
              <select id="hora" name="hora" required aria-required="true" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                <option value="" disabled selected>Selecciona una hora</option>
              </select>
            </div>
            <button type="submit" class="w-full bg-yellow-400 text-gray-900 font-semibold py-4 rounded-lg hover:bg-yellow-500 transition-colors text-lg font-['Poppins']">Reservar Turno</button>
          </form>
        </div>
      </div>
    </section>

    <section id="pagos" class="py-20 bg-gradient-to-b from-gray-900 to-gray-800">
      <div class="container mx-auto px-4 text-center">
        <div class="flex items-center justify-center mb-8">
          <h2 class="text-4xl font-bold font-['Poppins'] text-gray-200">Pagá con un clic</h2>
          <img src="img/logopago.png" alt="Logo de Pago" class="h-12 w-auto ml-4">
        </div>
        <p class="mb-6 text-lg text-gray-300">Alias: <strong id="alias-text">ulisesiglesias.mbs</strong></p>
        <button onclick="copiarAlias()" class="copy-button bg-yellow-400 text-gray-900 font-semibold py-3 px-6 rounded-lg hover:bg-yellow-500 transition-colors font-['Poppins']"><i class="fas fa-copy mr-2"></i> Copiar alias</button>
        <a href="https://link.mercadopago.com.ar/pasqui11" target="_blank" class="inline-block bg-blue-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-['Poppins'] mt-4">
          <img src="img/logomp.png" alt="Mercado Pago" class="inline-block h-6 w-auto mr-2"> Pagar con Mercado Pago
        </a>
        <p class="mt-6 text-lg text-gray-300"><a href="https://wa.me/+5493471511010?text=Hola,+te+env%C3%ADo+el+comprobante+de+mi+turno" target="_blank" class="text-yellow-400 hover:underline"><i class="fab fa-whatsapp mr-2"></i> Enviar comprobante por WhatsApp</a></p>
      </div>
    </section>

    <section id="contacto" class="py-20 bg-gradient-to-b from-gray-800 to-gray-900">
      <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold text-center mb-8 font-['Poppins'] text-gray-200">Contacto y Dirección</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="flex flex-col justify-center">
            <p class="mb-6 text-lg text-gray-300"><i class="fas fa-clock mr-3"></i> Horario: Martes a Sábados, 9:00-12:00 y 15:00-20:00</p>
            <p class="mb-6 text-lg text-gray-300"><i class="fas fa-phone mr-3"></i> Teléfono: <a href="https://wa.me/+5493471511010" target="_blank" rel="noopener" class="text-yellow-400 hover:underline">+54 9 3471 511010</a></p>
            <p class="mb-6 text-lg text-gray-300"><i class="fab fa-instagram mr-3"></i> Instagram: <a href="https://www.instagram.com/mbsbarberstudio/" target="_blank" rel="noopener" class="text-yellow-400 hover:underline">@mbsbarberstudio</a></p>
            <p class="mb-6 text-lg text-gray-300"><i class="fas fa-map-marker-alt mr-3"></i> Dirección: Calle 29 676, Las Parejas.</p>
          </div>
          <div class="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3353.123456789!2d-61.987654321!3d-32.682345678!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zQ2FsbGUgMjkgNjc2LCBMYXMgUGFyZWphcywgU2FudGEgRmUgMjUwNQ!5e0!3m2!1ses!2sar!4v1631234567890" width="100%" height="350" style="border:0; border-radius: 8px;" allowfullscreen="" loading="lazy" aria-label="Mapa de ubicación"></iframe>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Modal -->
    <div id="admin-modal" aria-label="Panel de administración">
      <div class="modal-content">
        <h2 class="text-2xl font-bold mb-4 font-['Poppins'] text-gray-200">Panel de Administración - Turnos</h2>
        <div class="action-bar">
          <button id="generarTurnos" class="font-['Poppins']"><i class="fas fa-calendar-plus mr-2"></i>Generar Turnos</button>
          <button id="refreshTurnos" class="font-['Poppins']"><i class="fas fa-sync-alt mr-2"></i>Refrescar</button>
          <button id="exportTurnos" class="font-['Poppins']"><i class="fas fa-download mr-2"></i>Exportar Turnos</button>
          <button id="importTurnos" class="font-['Poppins']"><i class="fas fa-upload mr-2"></i>Importar Turnos</button>
          <button id="logout" class="font-['Poppins']"><i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión</button>
        </div>
        <div class="mb-4">
          <label for="fechaGenerar" class="block text-sm font-medium mb-2 text-gray-200 font-['Poppins']"><i class="fas fa-calendar-alt"></i> Seleccionar Fecha para Generar Turnos:</label>
          <input type="date" id="fechaGenerar" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-400">
        </div>
        <table id="turnos-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Estado</th>
              <th>Cliente</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="listaTurnosAdmin"></tbody>
        </table>
        <div class="turnos-mobile" id="turnos-mobile"></div>
        <div class="action-bar">
          <button class="close-modal">Cerrar</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-gray-900 text-gray-200 py-12">
    <div class="container mx-auto px-4">
      <div class="text-center">
        <h3 class="text-2xl font-bold mb-6 font-['Poppins']">Conéctate con Nosotros</h3>
        <div class="flex justify-center space-x-6 mb-6">
          <a href="https://www.instagram.com/mbsbarberstudio/" target="_blank" rel="noopener" class="text-3xl hover:text-yellow-400 transition-colors"><i class="fab fa-instagram"></i></a>
          <a href="https://wa.me/+5493471511010" target="_blank" rel="noopener" class="text-3xl hover:text-yellow-400 transition-colors"><i class="fab fa-whatsapp"></i></a>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-10 pt-6 text-center">
        <p class="text-sm text-gray-300">&copy; 2025 MBS Barber Studio. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <a href="#turnos" class="floating-reserve-button" aria-label="Reservar Turno">
    <img src="img/logoreserva.png" alt="Ícono de reserva">
    <span class="font-['Poppins']">Reservar Turno</span>
  </a>

  <script>
    // Inicializar Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD0dfRMXPv35Qpe54P3xezjt4OAACM9Flc",
      authDomain: "peluqueriambs.firebaseapp.com",
      projectId: "peluqueriambs",
      storageBucket: "peluqueriambs.appspot.com",
      messagingSenderId: "687777736494",
      appId: "1:687777736494:web:e2ea7be639eaafee2a3cbf"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Horarios
    const horariosManana = ["09:00", "09:30", "10:00", "10:30", "11:00", "11:30", "12:00"];
    const horariosTarde = ["15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00", "19:30", "20:00"];
    const horarios = [...horariosManana, ...horariosTarde];
    const diasHabilitados = [2, 3, 4, 5, 6];

    // Parsear fecha desde DD/MM/YYYY o YYYY-MM-DD a Date
    function parseDMY(dateStr) {
      if (!dateStr) return null;
      if (dateStr.includes("/")) {
        const [day, month, year] = dateStr.split("/").map(Number);
        return new Date(year, month - 1, day);
      }
      if (dateStr.includes("-")) {
        const [year, month, day] = dateStr.split("-").map(Number);
        return new Date(year, month - 1, day);
      }
      return null;
    }

    // Formatear fecha a DD/MM/YYYY
    function formatDate(dateStr) {
      if (!dateStr) return "";
      let date;
      if (dateStr.includes("-")) {
        const [year, month, day] = dateStr.split("-").map(Number);
        date = new Date(year, month - 1, day);
      } else if (dateStr.includes("/")) {
        const [day, month, year] = dateStr.split("/").map(Number);
        date = new Date(year, month - 1, day);
      } else {
        return "";
      }
      if (isNaN(date)) return "";
      return `${date.getDate().toString().padStart(2, "0")}/${(date.getMonth() + 1).toString().padStart(2, "0")}/${date.getFullYear()}`;
    }

    // Formatear fecha a YYYY-MM-DD
    function formatDateToISO(date) {
      if (!(date instanceof Date) || isNaN(date)) return "";
      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, "0")}-${date.getDate().toString().padStart(2, "0")}`;
    }

    // Obtener turnos desde Firestore
    async function obtenerTurnos() {
      try {
        const querySnapshot = await db.collection("turnos").get();
        const turnos = [];
        querySnapshot.forEach((doc) => {
          turnos.push({ id: doc.id, ...doc.data() });
        });
        return turnos;
      } catch (error) {
        console.error("Error al obtener turnos: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudieron cargar los turnos. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
        return [];
      }
    }

    // Escuchar turnos en tiempo real
    function escucharTurnos(callback) {
      db.collection("turnos").onSnapshot((snapshot) => {
        const turnos = [];
        snapshot.forEach((doc) => {
          turnos.push({ id: doc.id, ...doc.data() });
        });
        callback(turnos);
      }, (error) => {
        console.error("Error al escuchar turnos: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudieron cargar los turnos en tiempo real. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      });
    }

    // Guardar turno en Firestore
    async function guardarTurno(turno) {
      try {
        const docRef = await db.collection("turnos").add(turno);
        console.log("Turno guardado con ID: ", docRef.id);
      } catch (error) {
        console.error("Error al guardar turno: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudo guardar el turno. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Generar ID secuencial para un turno
    async function generarIdTurno() {
      const turnos = await obtenerTurnos();
      const ids = turnos.map(t => parseInt(t.id) || 0);
      const maxId = Math.max(...ids, 0);
      return (maxId + 1).toString();
    }

    // Generar turnos para una fecha específica
    async function generarTurnos() {
      const fechaGenerar = document.getElementById("fechaGenerar").value;
      if (!fechaGenerar) {
        Swal.fire({
          icon: "warning",
          title: "Falta fecha",
          text: "Por favor, selecciona una fecha para generar los turnos.",
          confirmButtonColor: "#facc15"
        });
        return;
      }

      const selectedDate = parseDMY(fechaGenerar);
      if (!selectedDate || isNaN(selectedDate)) {
        Swal.fire({
          icon: "warning",
          title: "Fecha inválida",
          text: "Por favor, selecciona una fecha válida.",
          confirmButtonColor: "#facc15"
        });
        return;
      }

      if (!diasHabilitados.includes(selectedDate.getDay())) {
        Swal.fire({
          icon: "warning",
          title: "Día no laborable",
          text: "Por favor, selecciona un día laborable (martes a sábado).",
          confirmButtonColor: "#facc15"
        });
        return;
      }

      const turnos = await obtenerTurnos();
      const formattedDate = formatDate(fechaGenerar);
      const turnosExistentes = new Set(turnos
        .filter(t => t.fecha === formattedDate)
        .map(t => t.hora));

      const nuevosTurnos = [];
      for (const hora of horarios) {
        if (!turnosExistentes.has(hora)) {
          const id = await generarIdTurno();
          nuevosTurnos.push({
            id: id,
            fecha: formattedDate,
            hora: hora,
            Disponible: "Sí",
            nombre: "",
            telefono: ""
          });
        }
      }

      if (nuevosTurnos.length === 0) {
        Swal.fire({
          icon: "info",
          title: "Sin turnos nuevos",
          text: `Todos los turnos para ${formattedDate} ya están generados.`,
          confirmButtonColor: "#facc15"
        });
        return;
      }

      for (const turno of nuevosTurnos) {
        await guardarTurno(turno);
      }

      Swal.fire({
        icon: "success",
        title: "Turnos generados",
        text: `Se generaron ${nuevosTurnos.length} turnos para ${formattedDate} correctamente.`,
        timer: 2000,
        showConfirmButton: false
      });
      document.getElementById("fechaGenerar").value = "";
    }

    // Eliminar turno
    async function deleteTurno(id) {
      try {
        await db.collection("turnos").doc(id).delete();
        Swal.fire({
          icon: "success",
          title: "Turno eliminado",
          text: "El turno ha sido eliminado correctamente.",
          timer: 1500,
          showConfirmButton: false
        });
      } catch (error) {
        console.error("Error al eliminar turno: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudo eliminar el turno. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Actualizar turno
    async function updateTurno(id, disponible, nombre = "", telefono = "") {
      try {
        const turnos = await obtenerTurnos();
        const turno = turnos.find(t => t.id === id);
        if (!turno) {
          throw new Error("Turno no encontrado");
        }
        await db.collection("turnos").doc(id).update({
          Disponible: disponible,
          nombre: disponible === "Sí" ? "" : nombre,
          telefono: disponible === "Sí" ? "" : telefono
        });
        Swal.fire({
          icon: "success",
          title: "Turno actualizado",
          text: "El turno ha sido actualizado correctamente.",
          timer: 1500,
          showConfirmButton: false
        });
      } catch (error) {
        console.error("Error al actualizar turno: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudo actualizar el turno. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Login con Firebase Authentication
    async function login(email, password) {
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        console.log("Usuario logueado: ", userCredential.user.email);
        mostrarTurnosAdmin();
      } catch (error) {
        console.error("Error en login: ", error.message);
        Swal.fire({
          icon: "error",
          title: "Error de autenticación",
          text: error.message === "Firebase: Error (auth/invalid-credential)." 
            ? "Correo o contraseña incorrectos."
            : "No se pudo iniciar sesión. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Logout con Firebase Authentication
    async function logout() {
      try {
        await auth.signOut();
        console.log("Usuario desconectado");
        document.getElementById("admin-modal").classList.remove("active");
        Swal.fire({
          icon: "success",
          title: "Sesión cerrada",
          text: "Has cerrado sesión correctamente.",
          timer: 1500,
          showConfirmButton: false
        });
      } catch (error) {
        console.error("Error al cerrar sesión: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudo cerrar la sesión. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Mostrar prompt de login para administrador
    function mostrarPromptClave() {
      Swal.fire({
        title: "Acceso Administrativo",
        html: `
          <input type="email" id="adminEmail" class="swal2-input" placeholder="Correo electrónico">
          <input type="password" id="adminPassword" class="swal2-input" placeholder="Contraseña">
        `,
        showCancelButton: true,
        confirmButtonText: "Iniciar Sesión",
        cancelButtonText: "Cancelar",
        confirmButtonColor: "#facc15",
        cancelButtonColor: "#e3342f",
        preConfirm: () => {
          const email = document.getElementById("adminEmail").value;
          const password = document.getElementById("adminPassword").value;
          if (!email || !password) {
            Swal.showValidationMessage("Por favor, ingresa correo y contraseña");
            return false;
          }
          return { email, password };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          const { email, password } = result.value;
          login(email, password);
        }
      });
    }

    // Manejar toggle disponible
    async function handleToggleDisponible(id, currentDisponible) {
      const nuevoEstado = currentDisponible === "Sí" ? "No" : "Sí";
      await updateTurno(id, nuevoEstado);
    }

    // Manejar edición de nombre
    async function handleEditName(id, currentName, currentDisponible) {
      Swal.fire({
        title: "Editar Nombre del Cliente",
        input: "text",
        inputLabel: "Nombre del Cliente",
        inputValue: currentName,
        inputPlaceholder: "Ingresa el nombre del cliente",
        showCancelButton: true,
        confirmButtonText: "Guardar",
        cancelButtonText: "Cancelar",
        confirmButtonColor: "#facc15",
        cancelButtonColor: "#e3342f",
        inputValidator: (value) => {
          if (!value) {
            return "Debes ingresar un nombre";
          }
        }
      }).then(async (result) => {
        if (result.isConfirmed) {
          await updateTurno(id, "No", result.value);
        }
      });
    }

    // Manejar edición de turno
    async function handleEditTurno(id, currentFecha, currentHora, currentNombre, currentTelefono, currentDisponible) {
      Swal.fire({
        title: "Editar Turno",
        html: `
          <label class="block text-sm font-medium mb-2 text-gray-200">Fecha:</label>
          <input type="date" id="editFecha" value="${formatDateToISO(parseDMY(currentFecha))}" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 mb-4">
          <label class="block text-sm font-medium mb-2 text-gray-200">Hora:</label>
          <select id="editHora" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 mb-4">
            ${horarios.map(h => `<option value="${h}" ${h === currentHora ? "selected" : ""}>${h}</option>`).join("")}
          </select>
          <label class="block text-sm font-medium mb-2 text-gray-200">Nombre:</label>
          <input type="text" id="editNombre" value="${currentNombre}" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-900 text-gray-200 mb-4">
          <label class="block text-sm font-medium mb-2 text-gray-200">Teléfono:</label>
          <input type="tel" id="editTelefono" value="${currentTelefono}" pattern="[0-9]{10,}" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-900 text-gray-200">
        `,
        showCancelButton: true,
        confirmButtonText: "Guardar",
        cancelButtonText: "Cancelar",
        confirmButtonColor: "#facc15",
        cancelButtonColor: "#e3342f",
        preConfirm: async () => {
          const fecha = document.getElementById("editFecha").value;
          const hora = document.getElementById("editHora").value;
          const nombre = document.getElementById("editNombre").value;
          const telefono = document.getElementById("editTelefono").value;

          if (!fecha || !hora || !nombre || !telefono) {
            Swal.showValidationMessage("Todos los campos son obligatorios");
            return false;
          }

          const selectedDate = parseDMY(fecha);
          if (!selectedDate || isNaN(selectedDate)) {
            Swal.showValidationMessage("La fecha ingresada no es válida");
            return false;
          }

          if (!diasHabilitados.includes(selectedDate.getDay())) {
            Swal.showValidationMessage("La fecha debe ser un día laborable (martes a sábado)");
            return false;
          }

          const turnos = await obtenerTurnos();
          const turnoExists = turnos.some(t => t.fecha === formatDate(fecha) && t.hora === hora && t.id !== id);
          if (turnoExists) {
            Swal.showValidationMessage("Ya existe un turno en esa fecha y hora.");
            return false;
          }

          return { fecha, hora, nombre, telefono };
        }
      }).then(async (result) => {
        if (result.isConfirmed) {
          const { fecha, hora, nombre, telefono } = result.value;
          try {
            await db.collection("turnos").doc(id).set({
              id: id,
              fecha: formatDate(fecha),
              hora: hora,
              Disponible: "No",
              nombre: nombre,
              telefono: telefono
            });
            Swal.fire({
              icon: "success",
              title: "Turno actualizado",
              text: "El turno ha sido actualizado correctamente.",
              timer: 1500,
              showConfirmButton: false
            });
          } catch (error) {
            console.error("Error al actualizar turno: ", error);
            Swal.fire({
              icon: "error",
              title: "Error",
              text: "No se pudo actualizar el turno. Inténtalo de nuevo.",
              confirmButtonColor: "#facc15"
            });
          }
        }
      });
    }

    // Manejar eliminación de turno
    async function handleDeleteTurno(id) {
      Swal.fire({
        title: "¿Estás seguro?",
        text: "Esta acción eliminará el turno permanentemente.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Eliminar",
        cancelButtonText: "Cancelar",
        confirmButtonColor: "#dc2626",
        cancelButtonColor: "#e3342f"
      }).then(async (result) => {
        if (result.isConfirmed) {
          await deleteTurno(id);
        }
      });
    }

    // Exportar turnos a JSON
    async function exportTurnos() {
      try {
        const turnos = await obtenerTurnos();
        const dataStr = JSON.stringify(turnos, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `turnos_mbs_${new Date().toISOString().split("T")[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        Swal.fire({
          icon: "success",
          title: "Turnos exportados",
          text: "Los turnos se han exportado correctamente como archivo JSON.",
          timer: 1500,
          showConfirmButton: false
        });
      } catch (error) {
        console.error("Error al exportar turnos: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudieron exportar los turnos. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Importar turnos desde JSON
    async function importTurnos() {
      Swal.fire({
        title: "Importar Turnos",
        text: "Selecciona un archivo JSON con los turnos.",
        input: "file",
        inputAttributes: {
          accept: ".json",
          "aria-label": "Subir archivo JSON"
        },
        showCancelButton: true,
        confirmButtonText: "Importar",
        cancelButtonText: "Cancelar",
        confirmButtonColor: "#facc15",
        cancelButtonColor: "#e3342f"
      }).then(async (result) => {
        if (result.isConfirmed && result.value) {
          const file = result.value;
          const reader = new FileReader();
          reader.onload = async (e) => {
            try {
              const importedTurnos = JSON.parse(e.target.result);
              if (!Array.isArray(importedTurnos)) {
                throw new Error("El archivo no contiene una lista válida de turnos.");
              }
              const isValid = importedTurnos.every(t => 
                t.id && t.fecha && t.hora && t.Disponible && 
                (t.Disponible === "Sí" || (t.nombre && t.telefono))
              );
              if (!isValid) {
                throw new Error("El formato de los turnos no es válido.");
              }
              const existingTurnos = await obtenerTurnos();
              for (const turno of importedTurnos) {
                const turnoExists = existingTurnos.some(t => t.fecha === turno.fecha && t.hora === turno.hora);
                if (!turnoExists) {
                  const newId = await generarIdTurno();
                  await db.collection("turnos").doc(newId).set({ ...turno, id: newId });
                }
              }
              Swal.fire({
                icon: "success",
                title: "Turnos importados",
                text: "Los turnos se han importado correctamente.",
                timer: 1500,
                showConfirmButton: false
              });
            } catch (err) {
              console.error("Error al importar turnos: ", err);
              Swal.fire({
                icon: "error",
                title: "Error",
                text: `No se pudieron importar los turnos: ${err.message}`,
                confirmButtonColor: "#facc15"
              });
            }
          };
          reader.readAsText(file);
        }
      });
    }

    // Mostrar turnos en el panel de administración
    function mostrarTurnosAdmin() {
      escucharTurnos((turnos) => {
        const lista = document.getElementById("listaTurnosAdmin");
        const listaMobile = document.getElementById("turnos-mobile");
        lista.innerHTML = "";
        listaMobile.innerHTML = "";

        if (turnos.length === 0) {
          lista.innerHTML = `<tr><td colspan="6" class="text-center">No se encontraron turnos. Genera turnos para comenzar.</td></tr>`;
          listaMobile.innerHTML = `<p class="text-center text-gray-200">No se encontraron turnos. Genera turnos para comenzar.</p>`;
          document.getElementById("admin-modal").classList.add("active");
          return;
        }

        turnos.sort((a, b) => {
          const dateA = parseDMY(a.fecha);
          const dateB = parseDMY(b.fecha);
          return dateA - dateB || a.hora.localeCompare(b.hora);
        });

        turnos.forEach((t) => {
          const id = t.id || "";
          const fecha = t.fecha ? formatDate(t.fecha) : "Fecha no disponible";
          const hora = t.hora || "Hora no disponible";
          const disponible = t.Disponible || "Desconocido";
          const nombre = t.nombre || "";
          const telefono = t.telefono || "";
          const estado = disponible === "Sí" ? '<span style="color: #10b981;">Disponible</span>' : nombre ? '<span style="color: #facc15;">Reservado</span>' : '<span style="color: #e3342f;">No Disponible</span>';

          // Fila para la tabla (escritorio)
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${id}</td>
            <td>${fecha}</td>
            <td>${hora}</td>
            <td>${estado}</td>
            <td class="editable-name" onclick="handleEditName('${id}', '${nombre}', '${disponible}')">${nombre || "—"}</td>
            <td>
              <button class="toggle-disponible ${disponible === 'Sí' ? 'disponible' : 'no-disponible'}" onclick="handleToggleDisponible('${id}', '${disponible}')">
                ${disponible === "Sí" ? "Marcar No Disponible" : "Marcar Disponible"}
              </button>
              <button class="edit-turno" onclick="handleEditTurno('${id}', '${fecha}', '${hora}', '${nombre}', '${telefono}', '${disponible}')">
                Editar
              </button>
              <button class="delete-turno" onclick="handleDeleteTurno('${id}')">
                Eliminar
              </button>
            </td>
          `;
          lista.appendChild(row);

          // Tarjeta para móviles
          const card = document.createElement("div");
          card.className = "turno-card";
          card.innerHTML = `
            <p><strong>ID:</strong> ${id}</p>
            <p><strong>Fecha:</strong> ${fecha}</p>
            <p><strong>Hora:</strong> ${hora}</p>
            <p><strong>Estado:</strong> ${estado}</p>
            <p><strong>Cliente:</strong> <span class="editable-name" onclick="handleEditName('${id}', '${nombre}', '${disponible}')">${nombre || "—"}</span></p>
            <p><strong>Teléfono:</strong> ${telefono || "—"}</p>
            <div class="turno-actions">
              <button class="toggle-disponible ${disponible === 'Sí' ? 'disponible' : 'no-disponible'}" onclick="handleToggleDisponible('${id}', '${disponible}')">
                ${disponible === "Sí" ? "No Disponible" : "Disponible"}
              </button>
              <button class="edit-turno" onclick="handleEditTurno('${id}', '${fecha}', '${hora}', '${nombre}', '${telefono}', '${disponible}')">
                Editar
              </button>
              <button class="delete-turno" onclick="handleDeleteTurno('${id}')">
                Eliminar
              </button>
            </div>
          `;
          listaMobile.appendChild(card);
        });

        document.getElementById("admin-modal").classList.add("active");
      });
    }

    // Copiar alias al portapapeles
    function copiarAlias() {
      const alias = document.getElementById("alias-text").textContent;
      navigator.clipboard.writeText(alias).then(() => {
        const button = document.querySelector(".copy-button");
        button.innerHTML = '<i class="fas fa-check mr-2"></i> Copiado';
        setTimeout(() => {
          button.innerHTML = '<i class="fas fa-copy mr-2"></i> Copiar alias';
        }, 2000);
      }).catch((err) => {
        console.error("Error al copiar alias:", err);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudo copiar el alias. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      });
    }

    // Actualizar horarios disponibles para clientes
    async function updateTimeSlots() {
      const fechaInput = document.getElementById("fecha");
      const horaSelect = document.getElementById("hora");
      const selectedDate = fechaInput.value;
      horaSelect.innerHTML = '<option value="" disabled selected>Selecciona una hora</option>';

      if (!selectedDate) {
        horaSelect.disabled = true;
        return;
      }

      const parsedDate = parseDMY(selectedDate);
      if (!parsedDate || isNaN(parsedDate)) {
        Swal.fire({
          icon: "warning",
          title: "Fecha inválida",
          text: "Por favor, selecciona una fecha válida.",
          confirmButtonColor: "#facc15"
        });
        fechaInput.value = "";
        horaSelect.disabled = true;
        return;
      }

      if (!diasHabilitados.includes(parsedDate.getDay())) {
        Swal.fire({
          icon: "warning",
          title: "Día no laborable",
          text: "Solo se pueden reservar turnos de martes a sábado.",
          confirmButtonColor: "#facc15"
        });
        fechaInput.value = "";
        horaSelect.disabled = true;
        return;
      }

      const formattedSelectedDate = formatDate(selectedDate);
      try {
        const querySnapshot = await db.collection("turnos")
          .where("fecha", "==", formattedSelectedDate)
          .where("Disponible", "==", "Sí")
          .get();
        const disponibles = [];
        querySnapshot.forEach((doc) => {
          disponibles.push(doc.data());
        });

        disponibles.sort((a, b) => a.hora.localeCompare(b.hora));

        disponibles.forEach((t) => {
          const option = document.createElement("option");
          option.value = t.hora || "";
          option.textContent = t.hora ? `${t.hora} (Disponible)` : "Hora no disponible";
          horaSelect.appendChild(option);
        });

        horaSelect.disabled = false;
        if (disponibles.length === 0) {
          horaSelect.innerHTML = '<option value="" disabled selected>No hay horarios disponibles para esta fecha. Intenta con otra.</option>';
          horaSelect.disabled = true;
        }
      } catch (error) {
        console.error("Error al cargar horarios disponibles: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudieron cargar los horarios. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Manejar reserva de turno
    async function reservarTurno(event) {
      event.preventDefault();
      const nombre = document.getElementById("nombre").value;
      const telefono = document.getElementById("telefono").value;
      const fecha = document.getElementById("fecha").value;
      const hora = document.getElementById("hora").value;

      if (!fecha || !hora) {
        Swal.fire({
          icon: "warning",
          title: "Faltan datos",
          text: "Por favor, selecciona una fecha y hora válidas.",
          confirmButtonColor: "#facc15"
        });
        return;
      }

      const parsedDate = parseDMY(fecha);
      if (!parsedDate || isNaN(parsedDate)) {
        Swal.fire({
          icon: "warning",
          title: "Fecha inválida",
          text: "Por favor, selecciona una fecha válida.",
          confirmButtonColor: "#facc15"
        });
        return;
      }

      const formattedDate = formatDate(fecha);
      try {
        const querySnapshot = await db.collection("turnos")
          .where("fecha", "==", formattedDate)
          .where("hora", "==", hora)
          .where("Disponible", "==", "Sí")
          .get();
        let turno = null;
        querySnapshot.forEach((doc) => {
          turno = { id: doc.id, ...doc.data() };
        });

        if (!turno) {
          Swal.fire({
            icon: "warning",
            title: "Horario no disponible",
            text: "El turno seleccionado ya no está disponible. Por favor, elige otro horario.",
            confirmButtonColor: "#facc15"
          });
          return;
        }

        await db.collection("turnos").doc(turno.id).update({
          nombre: nombre,
          telefono: telefono,
          Disponible: "No"
        });

        Swal.fire({
          icon: "success",
          title: "Turno reservado",
          text: "Tu turno ha sido reservado con éxito.",
          timer: 2000,
          showConfirmButton: false
        });
        document.getElementById("reserva-form").reset();
        document.getElementById("fecha").value = "";
        document.getElementById("hora").innerHTML = '<option value="" disabled selected>Selecciona una hora</option>';
        document.getElementById("hora").disabled = true;
        await updateTimeSlots();
      } catch (error) {
        console.error("Error al reservar turno: ", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "No se pudo reservar el turno. Inténtalo de nuevo.",
          confirmButtonColor: "#facc15"
        });
      }
    }

    // Inicializar eventos y restricciones de fecha
    document.addEventListener("DOMContentLoaded", () => {
      const fechaInput = document.getElementById("fecha");
      const horaSelect = document.getElementById("hora");
      const today = new Date();
      const minDate = new Date(today);
      minDate.setDate(today.getDate() + 1);

      fechaInput.min = formatDateToISO(minDate);

      fechaInput.addEventListener("change", async (e) => {
        const selectedDate = parseDMY(e.target.value);
        if (!selectedDate || isNaN(selectedDate)) {
          Swal.fire({
            icon: "warning",
            title: "Fecha inválida",
            text: "Por favor, selecciona una fecha válida.",
            confirmButtonColor: "#facc15"
          });
          e.target.value = "";
          horaSelect.disabled = true;
          horaSelect.innerHTML = '<option value="" disabled selected>Selecciona una hora</option>';
          return;
        }

        const dayOfWeek = selectedDate.getDay();
        if (!diasHabilitados.includes(dayOfWeek)) {
          Swal.fire({
            icon: "warning",
            title: "Día no laborable",
            text: "Solo se pueden reservar turnos de martes a sábado.",
            confirmButtonColor: "#facc15"
          });
          e.target.value = "";
          horaSelect.disabled = true;
          horaSelect.innerHTML = '<option value="" disabled selected>Selecciona una hora</option>';
          return;
        }

        await updateTimeSlots();
      });

      horaSelect.disabled = true;

      // Vincular eventos de los enlaces de administración
      document.getElementById("admin-link").addEventListener("click", mostrarPromptClave);
      document.getElementById("admin-link-mobile").addEventListener("click", mostrarPromptClave);

      // Vincular botones de administración
      document.getElementById("generarTurnos").addEventListener("click", generarTurnos);
      document.getElementById("refreshTurnos").addEventListener("click", mostrarTurnosAdmin);
      document.getElementById("exportTurnos").addEventListener("click", exportTurnos);
      document.getElementById("importTurnos").addEventListener("click", importTurnos);
      document.getElementById("logout").addEventListener("click", logout);

      // Cerrar modal de administración
      document.querySelector("#admin-modal .close-modal").addEventListener("click", () => {
        document.getElementById("admin-modal").classList.remove("active");
      });
    });

    // Toggle menú móvil
    const menuToggle = document.querySelector(".menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    menuToggle.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
      mobileMenu.classList.toggle("active");
      menuToggle.innerHTML = mobileMenu.classList.contains("hidden") ? '<i class="fas fa-bars text-2xl"></i>' : '<i class="fas fa-times text-2xl"></i>';
    });

    // Cerrar menú móvil al hacer clic en un enlace
    document.querySelectorAll("#mobile-menu a").forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.add("hidden");
        mobileMenu.classList.remove("active");
        menuToggle.innerHTML = '<i class="fas fa-bars text-2xl"></i>';
      });
    });

    // Desplazamiento suave para enlaces de anclaje
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute("href"));
        const headerHeight = document.querySelector("header").offsetHeight;
        const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - headerHeight;

        window.scrollTo({
          top: targetPosition,
          behavior: "smooth"
        });
      });
    });
  </script>
</body>
</html>
